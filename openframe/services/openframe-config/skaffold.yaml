apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: openframe-config
build:
  artifacts:
    - image: ghcr.io/flamingo-stack/openframe-oss-tenant/openframe-config
      context: ../../../
      sync: 
        manual:
          - src: "**/*"
            dest: "/app"
      docker:
        dockerfile: openframe/services/openframe-config/Dockerfile
        buildArgs:
          GITHUB_ACTOR: "{{.GITHUB_ACTOR}}"
          GITHUB_TOKEN: "{{.GITHUB_TOKEN}}"
      hooks:
        before:
          - command: [ "mvn", "clean", "package", "-DskipTests"]
  local:
    useDockerCLI: false
    useBuildkit: true
    push: false
manifests:
  helm:
    releases:
      - name: openframe-config
        chartPath: ../../../manifests/microservices/openframe-config
        valuesFiles:
          - ../../../manifests/microservices/openframe-config/values.yaml
        setValues:
          config:
            branch:
              "main"
