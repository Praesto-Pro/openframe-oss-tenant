flowchart TD
    Browser["User Browser"] -->|"/tenant/..."| TenantFilter["TenantContextFilter"]
    TenantFilter --> AuthServer["Authorization Server Endpoints"]
    AuthServer --> SecurityConfig["SecurityConfig"]
    AuthServer --> AuthzConfig["AuthorizationServerConfig"]

    AuthzConfig --> JwtEncoder["JwtEncoder"]
    AuthzConfig --> JwtDecoder["JwtDecoder"]
    AuthzConfig --> JwkSource["Tenant JWKSource"]

    JwkSource --> TenantKeyService["TenantKeyService"]
    TenantKeyService --> MongoKeys[("TenantKey Repository")]

    AuthServer --> MongoAuthService["MongoAuthorizationService"]
    MongoAuthService --> MongoAuthRepo[("MongoOAuth2AuthorizationRepository")]

    SecurityConfig --> OidcService["OIDC User Service"]
    OidcService --> UserService["UserService"]
