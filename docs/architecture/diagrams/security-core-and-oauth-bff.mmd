flowchart LR
    subgraph Frontend["Tenant Frontend App"]
        Browser["Browser Client"]
    end

    subgraph BFF["Security Core And Oauth Bff"]
        OAuthController["OAuthBffController"]
        PKCE["PKCEUtils"]
        JwtConfigNode["JwtConfig"]
        JwtSecurity["JwtSecurityConfig"]
        RedirectResolver["DefaultRedirectTargetResolver"]
    end

    subgraph AuthServer["Authorization Server Core"]
        AuthEndpoints["OAuth2 Authorization Endpoints"]
        TokenEndpoint["Token Endpoint"]
    end

    Browser -->|"/oauth/login"| OAuthController
    OAuthController -->|"PKCE + state"| PKCE
    OAuthController -->|"Redirect to authorize"| AuthEndpoints
    AuthEndpoints -->|"Authorization Code"| OAuthController
    OAuthController -->|"Token Exchange"| TokenEndpoint
    OAuthController -->|"Issue Cookies"| Browser

    JwtSecurity --> JwtConfigNode
