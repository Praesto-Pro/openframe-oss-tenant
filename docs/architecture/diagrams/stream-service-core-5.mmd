flowchart TD
    Activity["ActivityMessage"] --> ReKeyA["Key by Activity ID"]
    HostActivity["HostActivityMessage"] --> ReKeyH["Key by Activity ID"]

    ReKeyA --> Join["Left Join (5s window)"]
    ReKeyH --> Join

    Join --> Enriched["Set hostId + agentId"]
    Enriched --> Header["Add MESSAGE_TYPE_HEADER"]
    Header --> Output["Publish to Enriched Topic"]
