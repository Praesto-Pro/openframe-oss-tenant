flowchart TD
    Browser["Browser or Client App"] -->|"Authorization Code Flow"| Gateway["Gateway Service Core"]
    Gateway -->|"/oauth2/authorize"| Authz["Authorization Service Core"]

    Authz --> TenantFilter["TenantContextFilter"]
    TenantFilter --> Security["SecurityConfig"]
    Security --> AuthServer["AuthorizationServerConfig"]

    AuthServer -->|"Load Client"| ClientRepo["MongoRegisteredClientRepository"]
    AuthServer -->|"Persist Tokens"| AuthService["MongoAuthorizationService"]
    AuthServer -->|"Sign JWT"| KeyService["TenantKeyService"]

    KeyService --> Mongo[("MongoDB")]
    ClientRepo --> Mongo
    AuthService --> Mongo
