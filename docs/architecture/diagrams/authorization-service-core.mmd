flowchart LR
    Browser["Browser / Frontend"] -->|"/login or /oauth2/authorize"| AuthServer["Authorization Service Core"]

    subgraph security_layer["Security Layer"]
        TenantFilter["TenantContextFilter"]
        SecurityConfigNode["SecurityConfig"]
        AuthServerConfigNode["AuthorizationServerConfig"]
    end

    subgraph sso_layer["SSO & Registration Flows"]
        InviteHandler["InviteSsoHandler"]
        TenantRegHandler["TenantRegSsoHandler"]
        AuthSuccess["AuthSuccessHandler"]
    end

    subgraph token_layer["Token & Key Management"]
        JwkSource["TenantKeyService"]
        JwtEncoderNode["JwtEncoder / JwtDecoder"]
        MongoAuthService["MongoAuthorizationService"]
    end

    AuthServer --> TenantFilter
    TenantFilter --> SecurityConfigNode
    SecurityConfigNode --> AuthServerConfigNode
    AuthServerConfigNode --> JwtEncoderNode
    JwtEncoderNode --> MongoAuthService
    JwkSource --> JwtEncoderNode
    AuthSuccess --> InviteHandler
    AuthSuccess --> TenantRegHandler
