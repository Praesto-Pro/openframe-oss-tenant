<!-- source-hash: a017969270edbe72d9a8c88f73fcda2d -->
Manages NATS server connections with automatic authentication, reconnection, and TLS configuration for the Flamingo agent platform.

## Key Components

- **`NatsConnectionManager`** - Main struct providing NATS connection lifecycle management
- **`connect()`** - Establishes connection with authentication, reconnection, and event handling
- **`get_client()`** - Returns the active NATS client for message operations
- **`build_nats_connection_url()`** - Constructs WebSocket NATS URLs with authorization tokens
- **`perform_reauthentication_and_build_url()`** - Handles automatic token refresh on auth failures

## Usage Example

```rust
use crate::services::nats_connection_manager::NatsConnectionManager;

// Create manager with required services
let manager = NatsConnectionManager::new(
    "wss://nats.flamingo.run".to_string(),
    config_service,
    initial_config_service,
    auth_service,
    tls_provider,
);

// Connect to NATS server
manager.connect().await?;

// Get client for message operations
let client = manager.get_client().await?;
client.publish("agent.status", "online".into()).await?;
```

The manager automatically handles authentication callbacks, token refresh, connection retries with 5-second delays, and conditional TLS configuration for local development environments. It uses WebSocket connections (`/ws/nats`) with JWT token-based authorization and includes machine ID headers for device identification.