suite: skip logic tests
templates:
  - templates/application.yaml
tests:
  - it: OSS localhost should skip ngrok-operator and include others
    set:
      deployment.oss.enabled: true
      deployment.oss.ingress.localhost.enabled: true
      deployment.oss.ingress.ngrok.enabled: false
    asserts:
      # Count verification - ngrok-operator skipped
      - hasDocuments:
          count: 39
      # Verify ingress-nginx is included
      - equal:
          path: metadata.name
          value: "ingress-nginx"
        documentSelector:
          path: metadata.name
          value: "ingress-nginx"
      # Verify openframe-authorization-server is included
      - equal:
          path: metadata.name
          value: "openframe-authorization-server"
        documentSelector:
          path: metadata.name
          value: "openframe-authorization-server"

  - it: OSS ngrok should skip ingress-nginx and include others
    set:
      deployment.oss.enabled: true
      deployment.oss.ingress.localhost.enabled: false
      deployment.oss.ingress.ngrok.enabled: true
    asserts:
      # Count verification - ingress-nginx skipped
      - hasDocuments:
          count: 39
      # Verify ngrok-operator is included
      - equal:
          path: metadata.name
          value: "ngrok-operator"
        documentSelector:
          path: metadata.name
          value: "ngrok-operator"
      # Verify openframe-authorization-server is included
      - equal:
          path: metadata.name
          value: "openframe-authorization-server"
        documentSelector:
          path: metadata.name
          value: "openframe-authorization-server"

  - it: should skip explicitly disabled apps
    set:
      deployment.oss.enabled: true
      deployment.oss.ingress.localhost.enabled: true
      apps.mongodb.enabled: false
    asserts:
      # One additional app (mongodb) should be skipped, plus ngrok-operator
      - hasDocuments:
          count: 38
