suite: edge cases and configuration tests
templates:
  - templates/argocd-apps.yaml
  - templates/projects.yaml
tests:
  # ========================================
  # MISSING CONFIGURATION HANDLING
  # ========================================

  - it: should handle missing optional configuration gracefully
    template: templates/argocd-apps.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Application
      - equal:
          path: metadata.name
          value: argocd-apps

  - it: should generate all templates with minimal configuration
    asserts:
      - hasDocuments:
          count: 1
        template: templates/argocd-apps.yaml
      - hasDocuments:
          count: 5
        template: templates/projects.yaml

  # ========================================
  # CUSTOM CONFIGURATION HANDLING
  # ========================================

  - it: should handle custom repository configuration
    template: templates/argocd-apps.yaml
    set:
      deployment.oss.repository.URL: "https://example.com/custom-repo.git"
      deployment.oss.repository.branch: "custom-branch"
      deployment.oss.repository.baseDir: "custom-dir"
      deployment.oss.repository.appsDir: "custom-apps-dir"
    asserts:
      - equal:
          path: spec.sources[0].repoURL
          value: "https://example.com/custom-repo.git"
      - equal:
          path: spec.sources[0].targetRevision
          value: "custom-branch"
      - equal:
          path: spec.sources[0].path
          value: "custom-dir/custom-apps-dir"

  # ========================================
  # ENVIRONMENT CONFIGURATION
  # ========================================

  - it: should propagate environment setting
    template: templates/argocd-apps.yaml
    set:
      environment: production
    asserts:
      - matchRegex:
          path: spec.sources[0].helm.values
          pattern: "environment: production"

  - it: should use default environment when not specified
    template: templates/argocd-apps.yaml
    asserts:
      - matchRegex:
          path: spec.sources[0].helm.values
          pattern: "environment: dev"
